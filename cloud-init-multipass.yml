#cloud-config

package_update: true
package_upgrade: true
packages:
  - apt-transport-https
  - ca-certificates
  - curl
  - wget
  - gnupg-agent
  - software-properties-common
  - avahi-daemon
  - libnss-mdns
  - openssh-server

runcmd:
  - curl -fsSL https://get.docker.com -O | sh
  - sudo usermod -aG docker $USER
  - snap install powershell --classic
  
write_files:
  - content: |
      [Service]
      Type=notify
      # the default is not to use systemd for cgroups because the delegate issues still
      # exists and systemd currently does not support the cgroup feature set required
      # for containers run by docker
      ExecStart=
      ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock -H unix:///var/run/docker.sock -H tcp://0.0.0.0:
      ExecReload=/bin/kill -s HUP $MAINPID
      TimeoutSec=0
      RestartSec=2
      Restart=always
    path: /etc/systemd/system/docker.service.d/override.conf
    owner: root:root
    permissions: '0644'

ssh_authorized_keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCk4KaJWaDq/xLOlOTE2IcNE8mAx0NXxc6AkN9GB8J3ePWl0RkWXWor+otswCBsI1hn1MU2qczHYvMCsvLuMMKdxSlSR6GbZ/0TO+UPvwiHtqhgZ1xkhDQN7/LN4VpuJKTm5SYrxv+DWRROlizktBcOchiADUeLrapkEgnMUcnp7g76FfI2VLLB5M2at4TLRVtOK9M0+JQA4gQWPKA3uHBPGNFhnCEtLMbS5Yg7eeR09aDxCV/aozMMzcKA6ou99rtSnGr8nqj3eA0v5GULLdIhdALkwmS/W43E+ZTTsgmUvACuuPoW0C3hN9pxSd/43jJ9cgYJ9YIe7m7qtFl1lJOskVAiCFR2oYT74zLWniJhmo9svtuPApqzcNdmBc02ppGa3Yeff0D1WShEJKnFVKF4MtYP66BVB7hszujbTIZ/FRRxjpgNlTnoY1NLTWYziZgU99ySU9wGqiOcAso7w4AY1WIn9+7UYPhURyLylODKn3t8nGNVYvtllKa7HUSfyYU=

power_state:
  mode: reboot
  message: Restarting after configuring Ubuntu for Docker and Docker-Compose
